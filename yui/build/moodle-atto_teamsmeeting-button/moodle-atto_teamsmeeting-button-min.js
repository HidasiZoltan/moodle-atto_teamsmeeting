YUI.add("moodle-atto_teamsmeeting-button",function(a,e){var t="atto_teamsmeeting",n={NEWWINDOW:"atto_teamsmeeting_openinnewwindow",URLINPUT:"atto_teamsmeeting_urlentry"},i=".atto_teamsmeeting_urlentry";a.namespace("M.atto_teamsmeeting").Button=a.Base.create("button",a.M.editor_atto.EditorPlugin,[],{_currentSelection:null,_content:null,_clientdomain:null,_appurl:null,initializer:function(){this._clientdomain=this.get("clientdomain"),this._appurl=this.get("appurl"),this.addButton({icon:"icon",iconComponent:"atto_teamsmeeting",callback:this._displayDialogue,tags:"a",tagMatchRequiresAll:!1})},_displayDialogue:function(){if(this._currentSelection=this.get("host").getSelection(),!1!==this._currentSelection){var e=this.getDialogue({headerContent:M.util.get_string("createteamsmeeting",t),width:"auto",focusAfterHide:!0,focusOnShowSelector:i});e.set("bodyContent",this._getDialogueContent()),this._resolveAnchors(),e.show()}},_resolveAnchors:function(){var e,t,n,i,o=this.get("host").getSelectionParentNode();o&&0<(e=this._findSelectedAnchors(a.one(o))).length&&(t=e[0],this._currentSelection=this.get("host").getSelectionFromNode(t),n=t.getAttribute("href"),i=t.getAttribute("target"),""!==n&&this._content.one(".url").setAttribute("value",n),"_blank"===i?this._content.one(".newwindow").setAttribute("checked","checked"):this._content.one(".newwindow").removeAttribute("checked"))},_meetingcheck:function(){var e,t;document.getElementById("meetingapp").contentDocument&&""!==(e=document.getElementById("meetingapp").contentDocument.location)&&-1<e.pathname.indexOf("teamsmeeting")&&(t=this._getqueryvariable("link",e),this._content.one(".url").set("value",t))},_getqueryvariable:function(e,t){var n,i,o=t.search.substring(1),a=o.split("&");for(n=0;n<a.length;n++)if(i=a[n].split("="),decodeURIComponent(i[0])==e)return decodeURIComponent(i[1]);console.log("Variable %s not found",e)},_setteamsmeeting:function(e){var t;e.preventDefault(),this.getDialogue({focusAfterHide:null}).hide(),""!==(t=this._content.one(".url").get("value"))&&(t=t.trim(),new RegExp(/^[a-zA-Z]*\.*\/|^#|^[a-zA-Z]*:/).test(t)||(t="http://"+t),this._setteamsmeetingOnSelection(t),this.markUpdated())},_setteamsmeetingOnSelection:function(e){var t,n,i,o=this.get("host");if(this.editor.focus(),o.setSelection(this._currentSelection),this._currentSelection[0].collapsed?((t=a.Node.create("<a>"+e+"</a>")).setAttribute("href",e),n=o.insertContentAtFocusPoint(t.get("outerHTML")),o.setSelection(o.getSelectionFromNode(n))):(document.execCommand("unlink",!1,null),document.execCommand("createlink",!1,e),n=o.getSelectionParentNode()),n)return i=this._findSelectedAnchors(a.one(n)),a.Array.each(i,function(e){this._content.one(".newwindow").get("checked")?e.setAttribute("target","_blank"):e.removeAttribute("target")},this),n},_findSelectedAnchors:function(e){var t,n,i=e.get("tagName");return i&&"a"===i.toLowerCase()?[e]:(n=[],e.all("a").each(function(e){!t&&this.get("host").selectionContainsNode(e)&&n.push(e)},this),0<n.length?n:(t=e.ancestor("a"))?[t]:[])},_getDialogueContent:function(){var e=a.Handlebars.compile('<form class="atto_form"><div class="meeting-app"><label class="meeting-app-label" for="meetingapp">{{get_string "createteamsmeeting" component}}</label><iframe id="meetingapp" src="{{appurl}}?url={{clientdomain}}"></iframe></div><div class="mb-1"><label for="{{elementid}}_atto_teamsmeeting_urlentry">{{get_string "meetingurl" component}}</label><input class="form-control fullwidth url {{CSS.URLINPUT}}" type="url" id="{{elementid}}_atto_teamsmeeting_urlentry" size="32"/></div><div class="form-check"><input type="checkbox" class="form-check-input newwindow" id="{{elementid}}_{{CSS.NEWWINDOW}}"/><label class="form-check-label" for="{{elementid}}_{{CSS.NEWWINDOW}}">{{get_string "openinnewwindow" component}}</label></div><div class="mdl-align"><br/><button type="submit" class="btn btn-secondary submit">{{get_string "addlink" component}}</button></div></form>');return this._content=a.Node.create(e({clientdomain:this._clientdomain,appurl:this._appurl,component:t,CSS:n})),this._content.one(".submit").on("click",this._setteamsmeeting,this),this._content.one("iframe").on("load",this._meetingcheck,this),this._content}},{ATTRS:{clientdomain:{value:null},appurl:{value:null}}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});